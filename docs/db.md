# Настройка базы данных

В билде OnyxBay используются MySQL базы данных. В силу исторических причин существует три базы данных:

- Старая - на данный момент кроме библиотеки не используется.
- Новая - основная база данных.
- Донаты - в ней хранится информация о донатах и прочее, слабо связанное с игровым процессом.

В папке `sql/` содержится Docker образ и схемы двух последних баз данных: новая - `feedback`, донаты - `donations`. В продакшене каждый сервер имеет свою `feedback` базу данных, но для простоты и разработки будет достаточно одной.

## Первоначальная настройка

- Необходимо установить `Docker Hub`: https://www.docker.com/get-started/
- Открыть в терминале папку с билдом:

```sh
$ cd OnyxBay/
```

- Собрать образ:

```sh
$ ./sql/Build.ps1
```

_Если у вас есть только bash/sh - выполняйте аналогичный файл но с расширением `.sh`_

### Запуск

```sh
$ ./sql/Run.ps1
```

В консоли могут появится ошибки - не страшно, это значит что контейнер запускается в первый раз.

### Остановка

Остановить контейнер с MySQL вы можете через интерфейс Docker Desktop или с помощью команды:

```sh
$ docker stop onyxdb
```

## Конфигурация

Конфигурация базы данных расположена в файле `config/dbconfig.txt` (если нет - распакуйте из папки `config/examples`). Из этого файла билд узнаёт куда надо подключаться и с каким логином/паролем.

По-умолчанию конфигурация уже сделана под Docker образ и её не нужно трогать.

## Возможные проблемы

> Как сделать себя администратором?

Необходимо добавить свой `ckey` и права в таблицу `erro_admin`, пример:

| id  | ckey     | rank | flags |
| --- | -------- | ---- | ----- |
| ... | igorsaux | Host | 12795 |

`ckey` - ваш `ckey`.

`rank` - ранг администратора, отображается в `adminwho`. `Host` - наивысший ранг.

`flags` - ваши права. Число `12795` даёт большинство необходимых прав. Остальные по необходимости можно будет добавить в игре.
