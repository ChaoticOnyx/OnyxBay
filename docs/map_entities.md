# Map Entities

Map entities полезны для создания скриптовых сценариев на одной или нескольких картах без изменения кодовой базы.
Есть несколько архитипов энтити, которые можно определить по префиксу:

 - `info_` - информационные энтити, не активируют другие энтити и прямо не влияют на окружение.
 - `trigger_` - энтити которые активируют другие энтити когда что-то где-то происходит.
 - `func_` - функциональные энтити, имеют непосредственное влияние на окружение. Могут быть активированы с помощью других энтити либо при инициализации.
 - `logic_` - логические энтити, в основном только анализируют и вызывают другие энтити.

Все переменные относящиеся к энтити имеют префикс `ev_`, остальные переменные менять в редакторе не рекомендуется. Далее будет описана только часть переменных которые могут быть не очевидны на первый взгляд.
Все энтити имеют переменную `ev_activate_at_startup`, у некоторых она заранее имеет значение 1. Значение 1 означает что энтити будет активирован после создания.

## `func_load_map`

### Активация

Загружает файл карты. В BYOND координаты отсчитываются от нижнего левого угла, соответственно, нижний левый тайл загружаемой карты будет находиться на месте этого энтити.

### Переменные

- `ev_map_path` - путь до файла с картой.
- `ev_clear_conents` - удаляет предметы с загружаемой карты, оставляя только турфы и некоторые вещи.

## `func_light`

### Активация

Источник света. Имеет механику освещения идентичную любым другим источникам света.

## `func_explosion`

### Активация

Создаёт в точке своего местоположения взрыв.

### Переменные

- `ev_z_transfer` - bool, влияет на то - будет ли взрыв влиять на другие Z уровни.
- `ev_shaped` - bool, при значении 1 взрыв будет более округлой формы.
- `ev_sfx` - путь до проигрываемого звука либо название набора звуков.

## `func_sfx`

### Активация

Проигрывает звук.

### Переменные

- `ev_vary` - bool, при значении 1 немного рандомизиует высоту звука.
- `ev_sound` - путь до проигрываемого звука либо название набора звуков.

## `func_sparks`

### Активация

Создаёт эффект искр.

### Переменные

- `ev_cardinal` - bool, при значении 1 искры будут лететь только в 4 стороны света - север, юг, запад и восток.

## `func_smoke`

### Активация

Создаёт эффект дыма.

### Переменные

- `ev_cardinal` - bool, при значении 1 искры будут лететь только в 4 стороны света - север, юг, запад и восток.
- `ev_direction` - направление движения дыма.

## `func_spawn`

### Активация

Создаёт предмет.

### Переменные

- `ev_target` - путь предмета, который необходимо заспавнить.
- `ev_new_args` - лист, значения которые будут переданы в конструктор предмета.
- `ev_unique` - bool, при значении 1 будет удалять предыдущий заспавненный предмет.
- `ev_dir` - направление предмета которое будет присвоено ему после появления.
- `ev_spawned` - референс на последний заспавленный предмет.

## `func_rand_spawn`

### Активация

Создаёт один случайно предмет.

### Переменные

- `ev_paths` - лист, пути предметов из которых будет случайно выбран один. Может иметь вид `list(/obj/foo = 50)`, где число - шанс появления.
- `ev_new_args` - лист, значения которые будут переданы в конструктор предмета.

## `func_write_var`

### Активация

Считывает переменные из одного предмета и записывает в другой.

### Переменные

- `ev_write_tag` - тэг или референс на предмет в который будут записаны переменные. Также можно указать пустую строку - `""`, в этом случае будет взят глобальный лист энтити `GLOB.map_ent_vars`.
- `ev_read_tag` - аналогичен переменной `ev_in_tag`. Отсюда будут взяты значения.
- `ev_table` - ассоциативный лист в котором указано куда и какая переменная будет записана.
- `ev_activate_writer` - bool, при значении 1 будет активирован энтити в который были записаны значения.
- `ev_activate_reader` - bool, при значении 1 и если в `ev_read_tag` энтити - последний будет активирован перед записью в `ev_write_tag`.

Пример: `ev_table = list("ev_tag" = "ev_spawned")`, в `ev_write_tag` будет `func_teleport`, а в `ev_read_tag` будет `func_spawner`. Если выразить это кодом то получим:
```dm
var/obj/map_ent/func_teleport/write = ...
var/obj/map_ent/func_spawner/read = ...

write.ev_tag = read.ev_spawned
```

## `func_strcat`

### Активация

Объединяет строки.

### Переменные

- `ev_lvalue` - текст, который будет находиться слева от оператора `+`.
- `ev_rvalue` - текст, который будет находиться справа от оператора `+`.
- `ev_result` - результат объединения.

## `func_teleport`

### Активация

Телепортирует предмет.

### Переменные

- `ev_tag` - тэг или референс предмета который нужно телепортировать.
- `ev_dest_tag` - тэг или референс предмета на координаты которого нужно телепортировать.

## `func_gib`

### Активация

Гибает моба.

### Переменные

- `ev_tag` - тэг или референс моба который нужно гибнуть.

## `info_text`

### Активация

Создаёт maptext на турфе на котором находиться этот энтити.

### Переменные

- `ev_text` - текст который нужно вывести.

## `info_bool`

Содержит в себе 0 либо 1.

### Активация

Инвертирует значение.

### Переменные

- `ev_value` - текущее значение.

## `info_counter`

Счётчик, содержит в себе растущее при активации число.

### Активация

Увеличивает значение счётчика на значение шага.

### Переменные

- `ev_value` - текущее значение.
- `ev_step` - значение шага.

## `info_string`

Содержит в себе строку.

### Активация

Активация ничего не делает.

### Переменные

- `ev_value` - текущее значение.

## `trigger_mob`

Активирует другой энтити при вхождении моба на турф на котором находится этот триггер.

### Активация

Активация ничего не делает.

### Переменные

- `ev_tag` - тэг или референс энтити который нужно активировать при срабатывании триггера.
- `ev_with_client` - bool, при значении 1 триггер будет срабатывать только на мобов с клиентом.
- `ev_ignore_ghosts` - bool, при значении 1 триггер будет игнорировать призраков.
- `ev_triggered` - референс последнего моба который затриггерил энтити.
- `ev_enabled` - bool, при значении 0 перестаёт триггериться.

## `trigger_button`

Активирует другой энтити при нажатии на кнопку.

### Активация

Активация ничего не делает.

### Переменные

- `ev_button_tag` - тэг или референс кнопки за нажатием на которую нужно следить. Если значение null - будет взята первая кнопка на тайле с триггером.
- `ev_tag` - тэг или референс энтити который будет активирован после нажатия на кнопку.
- `ev_triggered` - тэг или референс последнего нажавшего на кнопку моба.
- `ev_enabled` - bool, при значении 0 перестаёт триггериться.

## `trigger_signal`

Активирует другой энтити при срабатывании сигнала.

### Активация

Активация ничего не делает.

### Переменные

- `ev_signal` - название отслеживаемого сигнала.
- `ev_tag` - тэг или референс энтити который будет активирован после срабатывания сигнала.
- `ev_signal_source` - тэг или референс на объект чей сигнал нужно отслеживать, если null - будет подписан на глобальный сигнал.

## `logic_once`

### Активация

Активирует один раз энтити после чего уничтожается.

### Переменные

- `ev_tag` - тэг или референс энтити который будет активирован.

## `logic_relay`

### Активация

Активирует несколько энтитей подряд.

### Переменные

- `ev_tags` - лист с тэгами или референсами энтитей которые нужно активировать.

## `logic_timer`

Активирует энтити с некоторой переодичностью

### Активация

Включает/выключает таймер.

### Переменные

- `ev_tag` - тэг или референс энтити который будет активирован.
- `ev_wait` - время в децисекундах через которое нужно будет активировать энтити.
- `ev_once` - bool, если указано значение 1 - после срабатывания таймер будет выключен.
- `ev_enabled` - bool, если указано значение 0 - таймер перестанет работать.

## `map_engine`

### Активация

Формирует путь до карты-патча с необходимым двигателем в зависимости от настроек конфига.

### Переменные

- `ev_engine` - в переменную можно указать определённый тип движка, возможные значения: "random", "singularity", "supermatter". Если null - движок будет выбран на основе параметров конфига.
- `ev_result` - путь до карты с движком.
